
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>SWF Object Layer - Simpleflow documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.472b142f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.08040f6c.min.css">
        
          
          
          <meta name="theme-color" content="#7e56c2">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#swf-object-layer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Simpleflow documentation" class="md-header__button md-logo" aria-label="Simpleflow documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Simpleflow documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SWF Object Layer
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/botify-labs/simpleflow" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    botify-labs/simpleflow
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Simpleflow documentation" class="md-nav__button md-logo" aria-label="Simpleflow documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Simpleflow documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/botify-labs/simpleflow" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    botify-labs/simpleflow
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Intro
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Architecture
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Architecture" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Architecture
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/standalone/" class="md-nav__link">
        Standalone
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/multiprocess/" class="md-nav__link">
        Multiprocess
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        Quickstart
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Features
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Features" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Features
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../settings/" class="md-nav__link">
        Settings
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          SWF Object Layer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        SWF Object Layer
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#settings" class="md-nav__link">
    Settings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-usage" class="md-nav__link">
    Example usage
  </a>
  
    <nav class="md-nav" aria-label="Example usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models" class="md-nav__link">
    Models
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#querysets" class="md-nav__link">
    QuerySets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#events" class="md-nav__link">
    Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#history" class="md-nav__link">
    History
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decisions" class="md-nav__link">
    Decisions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actors" class="md-nav__link">
    Actors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../command_line/" class="md-nav__link">
        Command Line
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../program_tasks/" class="md-nav__link">
        Program Tasks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../jumbo_fields/" class="md-nav__link">
        Jumbo Fields
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../canvas/" class="md-nav__link">
        Canvas
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_7" type="checkbox" id="__nav_5_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_7">
          Advanced Features
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Advanced Features" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_7">
          <span class="md-nav__icon md-icon"></span>
          Advanced Features
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../signals/" class="md-nav__link">
        Signals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../steps/" class="md-nav__link">
        Steps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../task_lists/" class="md-nav__link">
        Task Lists
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tags/" class="md-nav__link">
        Tags
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../error_handling/" class="md-nav__link">
        Error Handling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../continue_as_new/" class="md-nav__link">
        Continue As New
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../middleware/" class="md-nav__link">
        Middleware
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../development/" class="md-nav__link">
        Development
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        License
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#settings" class="md-nav__link">
    Settings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-usage" class="md-nav__link">
    Example usage
  </a>
  
    <nav class="md-nav" aria-label="Example usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models" class="md-nav__link">
    Models
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#querysets" class="md-nav__link">
    QuerySets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#events" class="md-nav__link">
    Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#history" class="md-nav__link">
    History
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decisions" class="md-nav__link">
    Decisions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actors" class="md-nav__link">
    Actors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/botify-labs/simpleflow/edit/main/docs/src/features/swf_layer.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="swf-object-layer">SWF Object Layer<a class="headerlink" href="#swf-object-layer" title="Permanent link">&para;</a></h1>
<p><code>simpleflow</code> includes a <code>swf</code> module that is an object-oriented wrapper for the
<code>boto.swf</code> library, used to access the <a href="http://aws.amazon.com/swf">Amazon Simple Workflow</a> service.</p>
<p>It aims to provide:</p>
<ul>
<li><strong>Modelisation</strong>: Swf entities and concepts are to be manipulated through <em>Models</em> and
  <em>QuerySets</em> (any ressemblance with the Django API would not be a coincidence).</li>
<li><strong>High-level Events, History</strong>: A higher level of abstractions over SWF <em>events</em> and
  <em>history</em>. Events are implemented as stateful objects aware of their own state and
  possible transitions. History enhances the events flow description, and can be
  compiled to check its integrity and the activities statuses transitions.</li>
<li><strong>Decisions</strong>: Stateful abstractions above the SWF decision making system.</li>
<li><strong>Actors</strong>: SWF actors base implementation such as a <em>Decider</em> or an activity
  <em>Worker</em> from which the user can easily inherit to implement its own
  decision/processing model.</li>
</ul>
<h2 id="settings">Settings<a class="headerlink" href="#settings" title="Permanent link">&para;</a></h2>
<div class="admonition bug">
<p class="admonition-title">Bug</p>
<p>The informations in this "Settings" section may be outdated, they need some love.</p>
</div>
<p>Optional:</p>
<ul>
<li>region</li>
</ul>
<p>Settings are found respectively in:</p>
<p>A credential file a <code>.swf</code> file in the user’s home directory:</p>
<div class="highlight"><pre><span></span><code><span class="k">[credentials]</span><span class="w"></span>
<span class="na">aws_access_key_id</span><span class="o">=</span><span class="s">&lt;aws_access_key_id&gt;</span><span class="w"></span>
<span class="na">aws_secret_access_key</span><span class="o">=</span><span class="s">&lt;aws_secret_access_key&gt;</span><span class="w"></span>

<span class="k">[defaults]</span><span class="w"></span>
<span class="na">region</span><span class="o">=</span><span class="s">us-east-1</span><span class="w"></span>
</code></pre></div>
<p>The following environment variables
    - <code>AWS_ACCESS_KEY_ID</code>
    - <code>AWS_SECRET_ACCESS_KEY</code>
    - <code>AWS_DEFAULT_REGION</code></p>
<p>If neither of the previous methods were used, you can still set the AWS credentials with <code>swf.settings.set</code>:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">swf.settings</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">swf</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">aws_access_key_id</span><span class="o">=</span><span class="s2">&quot;MYAWSACCESSKEYID&quot;</span><span class="p">,</span>
<span class="o">...</span>                  <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="s2">&quot;MYAWSSECRETACCESSKEY&quot;</span><span class="p">,</span>
<span class="o">...</span>                  <span class="n">region</span><span class="o">=</span><span class="s2">&quot;REGION&quot;</span><span class="p">)</span>
<span class="c1"># And then you’re good to go...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">queryset</span> <span class="o">=</span> <span class="n">DomainQuery</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">queryset</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="p">[</span><span class="n">Domain</span><span class="p">(</span><span class="s2">&quot;test1&quot;</span><span class="p">),</span> <span class="n">Domain</span><span class="p">(</span><span class="s2">&quot;test2&quot;</span><span class="p">)]</span>
</code></pre></div>
<p>Leaving these AWS API keys unspecified is fine, as Boto’s credentials chain
handler will discover them if present.</p>
<h2 id="example-usage">Example usage<a class="headerlink" href="#example-usage" title="Permanent link">&para;</a></h2>
<h3 id="models">Models<a class="headerlink" href="#models" title="Permanent link">&para;</a></h3>
<p>Simple Workflow entities such as domains, workflow types, workflow executions and activity types are to be
manipulated through swf using <code>models</code>. They are immutable <code>swf</code> objects representations providing an
interface to objects attributes, local/remote objects synchronization and changes watch between these
local and remote objects.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Models reside in the swf.models module</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">swf.models</span> <span class="kn">import</span> <span class="n">Domain</span><span class="p">,</span> <span class="n">WorkflowType</span><span class="p">,</span> <span class="n">WorkflowExecution</span><span class="p">,</span> <span class="n">ActivityType</span>

<span class="c1"># Once imported you’re ready to create a local model instance</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">D</span> <span class="o">=</span> <span class="n">Domain</span><span class="p">(</span>
    <span class="s2">&quot;my-test-domain-name&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;my-test-domain-description&quot;</span><span class="p">,</span>
    <span class="n">retention_period</span><span class="o">=</span><span class="mi">60</span>
<span class="p">)</span>

<span class="c1"># a Domain model local instance has been created, but nothing has been</span>
<span class="c1"># sent to amazon. To do so, you have to save it.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">D</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>
<p>Now you have a local <code>Domain</code> model object, and if no errors were raised, the <code>save</code> method have saved
amazon-side. Sometimes you won’t be able to know if the model you’re manipulating has an upstream version:
whether you’ve acquired it through a queryset, or the remote object has been deleted for example.
Fortunately, models are shipped with a set of functions to make sure your local objects keep synced and
consistent.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Exists method lets you know if your model instance has an upstream version</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">D</span><span class="o">.</span><span class="n">exists</span>
<span class="kc">True</span>

<span class="c1"># What if changes have been made to the remote object?</span>
<span class="c1"># synced  and changes methods help ensuring local and remote models</span>
<span class="c1"># are still synced and which changes have been made (in the case below</span>
<span class="c1"># nothing has changed)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">D</span><span class="o">.</span><span class="n">is_synced</span>
<span class="kc">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">D</span><span class="o">.</span><span class="n">changes</span>
<span class="n">ModelDiff</span><span class="p">()</span>
</code></pre></div>
<p>What if your local object is out of sync? Models <code>upstream</code> method will fetch the remote version of
your object and will build a new model instance using its attributes.</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">D</span><span class="o">.</span><span class="n">is_synced</span>
<span class="kc">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">D</span><span class="o">.</span><span class="n">changes</span>
<span class="n">ModelDiff</span><span class="p">(</span>
    <span class="n">Difference</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;REGISTERED&quot;</span><span class="p">,</span> <span class="s2">&quot;DEPRECATED&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Let’s pull the upstream version</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">D</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">upstream</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">D</span><span class="o">.</span><span class="n">is_synced</span>
<span class="kc">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">D</span><span class="o">.</span><span class="n">changes</span>
<span class="n">ModelDiff</span><span class="p">()</span>
</code></pre></div>
<h3 id="querysets">QuerySets<a class="headerlink" href="#querysets" title="Permanent link">&para;</a></h3>
<p>Models can be retrieved and instantiated via querysets. To continue over the django comparison,
they’re behaving like django managers.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># As querying for models needs a valid connection to amazon service,</span>
<span class="c1"># Queryset objects cannot act as classmethods proxy and have to be instantiated;</span>
<span class="c1"># most of the time against a Domain model instance</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">swf.querysets</span> <span class="kn">import</span> <span class="n">DomainQuerySet</span><span class="p">,</span> <span class="n">WorkflowTypeQuerySet</span>

<span class="c1"># Domain querysets can be instantiated directly</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">domain_qs</span> <span class="o">=</span> <span class="n">DomainQuerySet</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">workflow_domain</span> <span class="o">=</span> <span class="n">domain_qs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MyTestDomain&quot;</span><span class="p">)</span>  <span class="c1"># and specific model retieved via .get method</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">workflow_qs</span> <span class="o">=</span> <span class="n">WorkflowTypeQuerySet</span><span class="p">(</span><span class="n">workflow_domain</span><span class="p">)</span>  <span class="c1"># queryset built against model instance example</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">workflow_qs</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="p">[</span><span class="n">WorkflowType</span><span class="p">(</span><span class="s2">&quot;TestType1&quot;</span><span class="p">),</span> <span class="n">WorkflowType</span><span class="p">(</span><span class="s2">&quot;TestType2&quot;</span><span class="p">),]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">workflow_qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">DEPRECATED</span><span class="p">)</span>
<span class="p">[</span><span class="n">WorkflowType</span><span class="p">(</span><span class="s2">&quot;DeprecatedType1&quot;</span><span class="p">),]</span>
</code></pre></div>
<h3 id="events">Events<a class="headerlink" href="#events" title="Permanent link">&para;</a></h3>
<p>(coming soon)</p>
<h3 id="history">History<a class="headerlink" href="#history" title="Permanent link">&para;</a></h3>
<p>(coming soon)</p>
<h3 id="decisions">Decisions<a class="headerlink" href="#decisions" title="Permanent link">&para;</a></h3>
<p>(coming soon)</p>
<h3 id="actors">Actors<a class="headerlink" href="#actors" title="Permanent link">&para;</a></h3>
<p>SWF workflows are based on a worker-decider pattern. Every actions in the flow is executed by a worker
which runs supplied activity tasks. And every actions is the result of a decision taken by the decider
reading the workflow events history and deciding what to do next. In order to ease the development of
such workers and decider, <code>swf</code> exposes base classes for them located in the <code>swf.actors</code> submodule.</p>
<ul>
<li>An <code>Actor</code> must basically implement a <code>start</code> and <code>stop</code> method and can actually inherits from whatever
  runtime implementation you need: thread, gevent, multiprocess...</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Actor</span><span class="p">(</span><span class="n">ConnectedSWFObject</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">task_list</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></pre></div>
<ul>
<li><code>Decider</code> base class implements the core functionality of a swf decider: polling for decisions tasks,
  and sending back a decision task copleted decision. Every other special needs implementations are left
  up to the user.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Decider</span><span class="p">(</span><span class="n">Actor</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">task_list</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_token</span><span class="p">,</span> <span class="n">decisions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">execution_context</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">poll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">identity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maximum_page_size</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>
<ul>
<li><code>Worker</code> base class implements the core functionality of a swf worker whoes role is to process activity
  tasks. It is basically able to poll for new activity tasks to process, send back a heartbeat to SWF
  service in order to let it know it hasn’t failed or crashed, and to complete, fail or cancel the activity
  task it’s processing.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ActivityWorker</span><span class="p">(</span><span class="n">Actor</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">task_list</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_token</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_token</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_token</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">heartbeat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_token</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">poll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../settings/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Settings" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Settings
            </div>
          </div>
        </a>
      
      
        
        <a href="../command_line/" class="md-footer__link md-footer__link--next" aria-label="Next: Command Line" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Command Line
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2017‒ — Botify
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
    
  </body>
</html>